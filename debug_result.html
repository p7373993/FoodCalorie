<!DOCTYPE html>
<html>
<head>
    <title>결과 페이지 디버깅</title>
</head>
<body>
    <h1>결과 페이지 디버깅</h1>
    <button onclick="checkSessionStorage()">세션 스토리지 확인</button>
    <button onclick="testMLServer()">ML 서버 테스트</button>
    <button onclick="testBackend()">백엔드 테스트</button>
    
    <div id="output"></div>

    <script>
        function log(message) {
            document.getElementById('output').innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }

        function checkSessionStorage() {
            log('=== 세션 스토리지 확인 ===');
            const mlTaskId = sessionStorage.getItem('mlTaskId');
            const uploadedImage = sessionStorage.getItem('uploadedImage');
            const analysisResult = sessionStorage.getItem('analysisResult');
            
            log('mlTaskId: ' + mlTaskId);
            log('uploadedImage: ' + (uploadedImage ? '있음' : '없음'));
            log('analysisResult: ' + (analysisResult ? '있음' : '없음'));
            
            if (analysisResult) {
                try {
                    const result = JSON.parse(analysisResult);
                    log('분석 결과 구조:');
                    log(JSON.stringify(result, null, 2));
                } catch (e) {
                    log('분석 결과 파싱 오류: ' + e.message);
                }
            }
        }

        async function testMLServer() {
            log('=== ML 서버 테스트 ===');
            try {
                const response = await fetch('http://localhost:8001/api/v1/pipeline-status');
                const result = await response.json();
                log('ML 서버 상태: ' + JSON.stringify(result, null, 2));
            } catch (e) {
                log('ML 서버 연결 실패: ' + e.message);
            }
        }

        async function testBackend() {
            log('=== 백엔드 테스트 ===');
            try {
                const response = await fetch('http://localhost:8000/mlserver/api/tasks/');
                const result = await response.json();
                log('백엔드 응답: ' + JSON.stringify(result, null, 2));
            } catch (e) {
                log('백엔드 연결 실패: ' + e.message);
            }
        }

        // 페이지 로드 시 자동 확인
        window.onload = function() {
            checkSessionStorage();
        };
    </script>
</body>
</html>